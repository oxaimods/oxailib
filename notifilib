local NotificationLib = {}

-- Services
local TweenService = game:GetService("TweenService")
local Players = game:GetService("Players")

local player = Players.LocalPlayer
local playerGui = player:WaitForChild("PlayerGui")

-- ===== ScreenGui =====
local screenGui = playerGui:FindFirstChild("NotificationGui")
if not screenGui then
	screenGui = Instance.new("ScreenGui")
	screenGui.Name = "NotificationGui"
	screenGui.ResetOnSpawn = false
	screenGui.Parent = playerGui
end

-- ===== DEFAULT SETTINGS =====
NotificationLib.Settings = {
	Width = 240,
	Height = 90,
	Spacing = 10,
	BaseYOffset = -120,
	SlideTime = 0.4,

	TitleFont = Enum.Font.GothamBold,
	BodyFont = Enum.Font.Gotham,

	TitleTextSize = 18,
	BodyTextSize = 16,
	CornerRadius = 10,
}

-- ===== THEMES =====
NotificationLib.Themes = {
	--midnight theme
	[1] = { TextColor = Color3.fromRGB(255,255,255), BackgroundColor = Color3.fromRGB(84,51,116), SeparatorColor = Color3.fromRGB(130,74,184) },
	-- grey theme
	[2] = { TextColor = Color3.fromRGB(255,255,255), BackgroundColor = Color3.fromRGB(60,60,60), SeparatorColor = Color3.fromRGB(50,50,50) },
	-- scintilla
	[3] = { TextColor = Color3.fromRGB(130,74,184), BackgroundColor = Color3.fromRGB(70,70,70), SeparatorColor = Color3.fromRGB(130,74,184) },
	[4] = { TextColor = Color3.fromRGB(255,0,0), BackgroundColor = Color3.fromRGB(0,0,0), SeparatorColor = Color3.fromRGB(255,100,100) },
}

local ACTIVE_NOTIFS = {}

-- ===== INTERNAL: Update Stack =====
local function updateStack()
	for i, frame in ipairs(ACTIVE_NOTIFS) do
		local targetY =
			NotificationLib.Settings.BaseYOffset
			- ((i - 1) * (NotificationLib.Settings.Height + NotificationLib.Settings.Spacing))

		TweenService:Create(
			frame,
			TweenInfo.new(NotificationLib.Settings.SlideTime, Enum.EasingStyle.Quint, Enum.EasingDirection.Out),
			{ Position = UDim2.new(0, 15, 1, targetY) }
		):Play()
	end
end

-- ===== PUBLIC API =====
function NotificationLib.Notify(themeID, title, text, duration)
	duration = duration or 3
	themeID = themeID or 1
	local theme = NotificationLib.Themes[themeID] or NotificationLib.Themes[1]

	local notif = Instance.new("Frame")
	notif.Size = UDim2.new(0, NotificationLib.Settings.Width, 0, NotificationLib.Settings.Height)
	notif.Position = UDim2.new(0, -NotificationLib.Settings.Width - 20, 1, NotificationLib.Settings.BaseYOffset)
	notif.BackgroundColor3 = theme.BackgroundColor
	notif.BorderSizePixel = 0
	notif.Parent = screenGui

	local corner = Instance.new("UICorner")
	corner.CornerRadius = UDim.new(0, NotificationLib.Settings.CornerRadius)
	corner.Parent = notif

	-- Title
	local titleLabel = Instance.new("TextLabel")
	titleLabel.Size = UDim2.new(1, -10, 0, 24)
	titleLabel.Position = UDim2.new(0, 5, 0, 5)
	titleLabel.BackgroundTransparency = 1
	titleLabel.Text = tostring(title)
	titleLabel.Font = NotificationLib.Settings.TitleFont
	titleLabel.TextSize = NotificationLib.Settings.TitleTextSize
	titleLabel.TextColor3 = theme.TextColor
	titleLabel.TextXAlignment = Enum.TextXAlignment.Left
	titleLabel.TextYAlignment = Enum.TextYAlignment.Center
	titleLabel.Parent = notif

	-- Separator
	local separator = Instance.new("Frame")
	separator.Size = UDim2.new(1, -15, 0, 1)
	separator.Position = UDim2.new(0, 5, 0, 34)
	separator.BackgroundColor3 = theme.SeparatorColor
	separator.BorderSizePixel = 0
	separator.Parent = notif

	-- Body
	local bodyLabel = Instance.new("TextLabel")
	bodyLabel.Size = UDim2.new(1, -10, 1, -45)
	bodyLabel.Position = UDim2.new(0, 5, 0, 40)
	bodyLabel.BackgroundTransparency = 1
	bodyLabel.TextWrapped = true
	bodyLabel.Text = tostring(text)
	bodyLabel.Font = NotificationLib.Settings.BodyFont
	bodyLabel.TextSize = NotificationLib.Settings.BodyTextSize
	bodyLabel.TextColor3 = theme.TextColor
	bodyLabel.TextXAlignment = Enum.TextXAlignment.Left
	bodyLabel.TextYAlignment = Enum.TextYAlignment.Center
	bodyLabel.Parent = notif

	table.insert(ACTIVE_NOTIFS, notif)
	updateStack()

	task.spawn(function()
		task.wait(duration)
		local index = table.find(ACTIVE_NOTIFS, notif)
		if index then table.remove(ACTIVE_NOTIFS, index) end

		TweenService:Create(
			notif,
			TweenInfo.new(NotificationLib.Settings.SlideTime, Enum.EasingStyle.Quint, Enum.EasingDirection.In),
			{ Position = UDim2.new(0, -NotificationLib.Settings.Width - 20, notif.Position.Y.Scale, notif.Position.Y.Offset) }
		):Play()

		task.wait(NotificationLib.Settings.SlideTime)
		notif:Destroy()
		updateStack()
	end)
end

return NotificationLib
